Linear III. CODELESS SPOOFING DETECTION TECHNIQUE 
This section develops an implementation of the codeless spoofing detection algorithm of Refs. 11 and 12. A significant amount of this material is taken from Ref. 12, but the notation has been changed in a number of places in order to conform with the models in Section II of the present paper. In addition to the notation changes, the developments of the present section include implementation details that are not found elsewhere. 
A. Computation of the Raw Codeless Spoofing Detection Statistic 
The raw codeless spoofing detection statistic is the sum of products of quadrature samples from Receivers A and B. In other words, it is the sum of products of Eq.  samples and Eq.  samples. Before forming products, however, it is necessary to map sample times in the two receivers to identical values as measured relative to their respective tracked C/A codes. This inter-receiver time mapping relies on the DLL estimates of the C/A code start/stop times, ... Suppose, in addition, that there is a known differential relative timing offset between the filtered P(Y) code and the DLL estimate of the filtered C/A code. This offset is denoted by **, and it represents a difference between the two receivers. It is a measure of the amount by which the filtered P(Y) code in Receiver B is delayed relative to that receiver's DLL-generated C/A code replica when compared to the filtered P(Y) code in Receiver A. Nominally, one would expect this differential timing offset to be zero or nearly so. A non-zero value is allowed in the present analysis in order to make it more general and to facilitate an experimental study of the magnitude of this delay. Suppose that the correlation calculation seeks the correct quadrature sample from Receiver B to correlate with sample yqai from Receiver A, which was sampled at Receiver A clock time tai. Suppose that the delayed sample time (tai+?tab) lies in the Receiver A DLL's estimate of the reception interval of the kth C/A PRN code period. That is, suppose that ?ak ? (tai+?tab) < ?ak+1. Then the first step in the correlation process is to compute the corresponding time according to Receiver B's clock. Using linear interpolation between DLL code start/stop times, it is:   This Receiver B time estimate can be used to interpolate between Receiver B quadrature samples from Eq.  in order to synthesize the "sample" of the Receiver-B quadrature signal that corresponds to the Receiver-A sample yqai. Suppose that the interpolated time bi t ~ from Eq.  lies between Receiver-B RF sample times tbj and tbj+1. Then the synthesized quadrature sample of Receiver B is the linearly interpolated value:  The Receiver-A quadrature samples from Eq.  and the synthesized Receiver-B quadrature samples from Eq.  are multiplied together and summed in order to form the un-normalized codeless spoofing detection statistic:  The index il in this formula is the initial sample of the correlation accumulation interval, and M is the total number of samples used in each accumulation. This lth un-normalized spoofing detection statistic spans a data interval of length Tcorr = M?t sec, where ?t = tai+1 - tai is the RF front-end sample period. The mid-point of this interval is  according to the Receiver-A clock. 
B. Hypothesis Test for Spoofing based on a Normalized Codeless Detection Statistic 
The spoofing detection statistic in Eq.  has significantly different properties depending on whether or not the C/A code signal tracked by Receiver B is a spoofed signal. If the signal is not spoofed, then the synthesized qbi y ~ quadrature sample is assumed to be modeled by Eq. . If the signal is spoofed, however, then the P(Y) code is presumed to be absent from the quadrature channel of Receiver B. In this case, Eq.  is modified to setting the P(Y)-code amplitude to Apb = 0. Under the hypothesis of spoofing, hypothesis H1, the mean and variance of the spoofing detection statistic ?ul are   where n~qbi is the noise in the synthesized quadrature sample qbi y ~ , which is assumed to obey the same statistics as nqbi in Eqs.  and . The quantity 2 PYf is the mean value of 2 PYf , i.e., it is the power of the distorted P(Y) code at the output of the RF front-end filter. The quantity (C/N0)pya = A2paPY2f /(4? R2Fa?t) is the filtered P(Y)-code carrier-to-noise ratio in Receiver A. The derivations in Eqs.  and  depend on the assumptions that E{n~qbin~qbj} = 0 for all (i,j) such that 9 i ? j and that E{nqain~qbj} = 0 for all (i,j). Under the hypothesis of no spoofing, hypothesis H0, the mean and variance of ?ul are   where (C/N0)pyb = A2pbPY2f /(4? R2Fb?t) is the P(Y)-code carrier-to-noise ratio in Receiver B. The derivations in Eqs.  and  assume that the mean value of the product PYf (tai )PYf (~tbi ) also equals 2 PYf . This is reasonable when the RF front-end filters are similar because the Receiver A time tai and the Receiver B time bi t ~ are the same times relative to their respective P(Y) codes by virtue of the construction of bi t ~ in Eq. . Of course, a stricter use of notation would have created slightly different function names for PYf(t) in the two receivers in order to allow them to take on the same value at the different input time arguments tai and bi t ~ . The carrier-to-noise ratios (C/N0)pya and (C/N0)pyb in the final forms of Eqs. - are used in place of terms involving 2 2 ApaPYf and 2 2 ApbPYf . This convention is adopted because it is convenient to deduce the carrier-tonoise ratios. The determination of (C/N0)pya and (C/N0)pyb begins with a determination of the corresponding C/Acode carrier-to-noise ratios. Given a time history of prompt accumulations Ik and Qk for the C/A code, the calculation starts by determining the mean amplitude of the accumulation vector [Ik; Qk] and the noise variance in each of this vector's components:   As a side benefit, the accumulation variance in Eq.  can be used to estimate the effective variance of the noise in the raw RF samples:   where Naccum = (N1+N2+...+NK)/K is the average number of samples in an accumulation. The value of this variance for each receiver is needed in Eqs.  to . The C/A-code carrier-to-noise ratio is computed from the accumulation amplitude and variance in Eqs.  and . Given the accumulation interval Taccum = ?t Naccum , the carrier-to-noise ratio is:   Given the C/A-code carrier-to-noise ratio, the P(Y) code carrier-to-noise ratio can be computed. This calculation considers the effects of filter loss and distortion, as per Eqs.  and , and the transmitted power decrement of the P(Y) code in comparison to the C/A code, as per Eq. . The resulting formula is   The power of 10 in this equation adjusts for the fact that the Lfca loss calculation in Eq.  presumes an infinite bandwidth of the transmitted C/A code instead of the actual 20.46 MHz bandwidth. The term in square 10 brackets on the right-hand side of this equation is what the received C/A-code carrier-to-noise ratio would have been had there been no loss in the filter or in the prompt accumulation calculations. The formulas in Eqs. - apply to Receivers A and B. The usual "a" and "b" subscripts can be added to each of the quantities in order to denote the receiver to which it applies. Typically the variance results in Eqs. , , and  are computed only once when the receiver is operating on a quiescent signal with very little actual amplitude fluctuation. These quantities tend to remain constant over time due to the actions of the RF front-end's automatic gain control. The signal power quantities in Eqs.  and  and the associated carrier-to-noise ratios in Eqs.  and  are typically re-computed continually. One might recompute them for each spoofing detection accumulation interval. This approach enables the spoofing detection test to adapt to the time variations in signal power that typically occur. Before developing the spoofing test, it is helpful to normalize the test statistic. A suitable normalization is to divide ?ul by its standard deviation under the spoofed hypothesis H1, ??u|H1 . This produces the normalized spoofing test statistic:  The results in Eqs. - can be used to compute the means and standard deviations of this statistic under the respective hypotheses of spoofing on Receiver B, H1, and no spoofing, H0. These quantities are:   The means and variances in Eqs. - can be used to design and analyze a sensible spoofing detection test. The necessary derivations require knowledge of the spoofed and un-spoofed probability density functions p( ? l|H1) and p( ? l|H0). The exact formulas for these functions are complicated because they involve products of the Gaussian noise terms nqai and n~qbi . Fortunately, the randomness in ? l is the result of many such product terms. Therefore, the central limit theorem can be invoked in order to model these two probability density functions as Gaussian distributions. Given the Gaussian assumption and given the allowable false-alarm probability ?FA, the spoofing detection threshold ?th can be computed by solving the following equation:   This threshold is used to determine whether the signal in Receiver B is being spoofed according to the following rule: If ? l ? ?th, then accept the H0 hypothesis that there is no spoofing, but if ? l < ?th, accept the H1 hypothesis that there is spoofing. This threshold and spoofing test lead to the following probability of a successful detection:   Note that the H0 un-spoofed hypothesis is somewhat unusual: It has a non-zero mean that is calculated by factoring down the measured C/A carrier-to-noise ratio in order to estimate the P(Y) carrier-to-noise ratio. It is important to use the proper calculation of the C/A carrierto- noise ratio in Eqs. - and the proper attenuation to get the P(Y) carrier-to-noise ratio in Eq. . Errors in these calculations will cause errors in the un-spoofed expected value ? H0 and in the spoofing detection threshold ?th. These errors will cause the detection test to have a different false-alarm probability and a different probability of detection than are given in Eqs.  and . The analysis of this section assumes that the noise in the quadrature baseband-mixed signal is purely white noise. This assumption is violated to some extent in any real receiver. For the receivers considered in the present study, their departures from the white-noise assumption do not appear to be large enough to have a significant impact on the spoofing detection results. If the nonwhiteness of the noise were an issue, then it would be straight-forward to adapt the foregoing analysis appropriately. This adaptation is omitted for the sake of brevity. The detection statistic ? l would be the optimal Neyman- Pearson detection statistic 22 if the noise in Receiver A were negligible and if the prediction of the P(Y) carrierto- noise ratios for the two receivers were exact. In that 11 case, the Receiver-A quadrature signal would yield a perfect scaled replica of the encrypted P(Y) code. One could use this replica and the P(Y) amplitudes on Receivers A and B in order to derive the joint probability density functions for yqbi for i = il, ..., il+M-1 under the two hypotheses. One could demonstrate a monotonic, one-to-one correspondence between the ratio of these two probability density functions and the ? l test statistic. This correspondence would prove the optimality of the ? l statistic. The use of a sub-optimal test statistic is necessitated by the receivers' imperfect knowledge of the P(Y) signal. 
C. Potential for Cross-Talk between Channels 
There is a potential for the P(Y) code or even the C/A code of another GPS signal to affect the spoofing detection statistic ? l in Eq. . This can happen if the Doppler shifts and code delays of the other GPS signal line up in a certain way with those of the signal for which spoofing detection is being performed. The necessary Doppler alignment to cause interference is that of a zerovalued or nearly zero-valued Doppler double difference between the two receivers and the two signals. That is, if the carrier Doppler shift difference between the two GPS signals is the same at both the reference receiver and the defended receiver, then there is a potential interference. This difference must be smaller than the correlation accumulation frequency 1/Tcorr. Otherwise, the averaging action of the accumulation in Eq.  will attenuate the interference. An additional requirement for interference between two signals is that their double-differenced PRN code phase be zero or nearly zero. That is, the C/A code period start/stop time difference between the two signals for the reference receiver must equal this same difference for the defended receiver. If this code-phase double difference is less than the correlation time of the filtered P(Y) code, then un-intended cross-correlations of the P(Y) code of the other signal can appear in the ? l spoofing detection statistic of Eq. . Similarly, if this code-phase double difference is less than a C/A code PRN chip length, then un-intended cross-correlations of the other signal's C/A code can appear in ? l. The C/A code of the second signal could affect the P(Y) cross-correlation of the signal in question because the second C/A code could lie nearly in phase quadrature with the C/A code of the original signal. This type of interference was noted in the study of codeless cross-correlation spoofing detection found in Ref. 12. In that study, the two receivers were both located in Ithaca, NY. Given this close proximity, the carrier Doppler shift double differences and the code phase double differences were likely to be small, and interference was likely to occur. Under normal conditions, it is unlikely that two signals will interfere due to small double differences in Doppler shift and code phase. Large double differences will normally be caused by the necessary receiver separation between the secure reference receiver and the defended receiver. If both double differences are small, however, then this fact will be noticeable from the C/A code tracking, and the spoofing detection calculations for the signals in question must be ignored or modified. Otherwise, the computed ? l can be much larger than expected, much smaller than expected, or even negative 12. These possibilities arise because additional non-zero correlations of the second signal can add constructively or destructively to alter the mean value of ? l. It is possible to reduce or even eliminate this type of interference at the reference station. The necessary infrastructure would be a high-gain antenna system with independently steerable beams, such as could be provided by a phased array. Given sufficient gain, the interference effects of other signals on ? l would be negligible even with zero-valued double differences of Doppler shift and code phase. 
IV. SEMI-CODELESS SPOOFING DETECTION TECHNIQUE 
The semi-codeless spoofing detection technique attempts to improve the power of the spoofing detector by employing additional a priori knowledge about the P(Y) code. This a priori knowledge is the fact that P(Y) is generated by mixing the known P code with the unknown W encryption chips, as described in Subsection II.C. 
A. "Hard" W Chip Estimates 
The heart of the semi-codeless spoofing detection method is an estimator for the unknown +1/-1 values of the wj chips in Eq. . For a given interval of interest, the estimates are formed by solving the following batch leastsquares estimation problem: find: w1, w2, w3, ..., wK  to minimize:   subject to: wj = -1 or +1 for j = 1, ..., K  The cost function in Eq.  is half the sum of the squared errors in M instances of Eq.  or , depending on the receiver in question. This cost formula uses the W-chips model of the PYf(t) function in Eq.  in order to frame the problem explicitly in terms of unknown W chips. Note that Eqs. - do not include "a" or "b" subscripts. These have been omitted because this estimation problem applies equally to both receivers. For the same set of W-chips, however, there is an independent W-chip estimation problem based on each 12 receiver's independent quadrature samples and on each receiver's Pfwj(t) as dictated by the impulse response of its RF front-end's band-pass filter. The sample indices i and the W-chip indices j in this problem are defined somewhat arbitrarily in order to simplify the estimation problem statement. In practice, the range of the RF sample index i might be different from 1 to M, and the W-chip index range might be different from 1 to K. The first RF sample, sample i = 1 at time t1 in the problem above, should be the initial sample in the P(Y) code interval associated with the initial W-chip function Pfw1(t), as per Fig. 2. Similarly, the last RF sample, sample i = M at time tM, should be the final sample associated with the final W-chip function PfwK(t). The number of W chips estimated in a given batch optimization, K, is arbitrary. A sensible choice would set K equal to the number of W chips that were used to calculate a single semi-codeless spoofing detection statistic. Thus, if a 0.2 sec correlation were used for each independent detection statistic, then a sensible choice of K would be (0.2sec)x(480,000 W-chips/sec) = 96,000 Wchips. The cost function in Eq.  presumes that the timing of the received, RF-filtered W chips is known exactly according to the receiver clock. That is, the functions Pfwj(t) are presumed to be known with t measured in receiver clock time. This knowledge depends on the working of the C/A-code DLL, on knowledge of the relative delays between the filtered C/A-code chips and the filtered P-code chips that comprise Pfwj(t), and on knowledge of the nominal W-chip timing relative the nominal C/A code timing at the transmitter. The latter knowledge is well defined by the GPS Interface Specification 20 in conjunction with the W-chip timing studies associated with Refs. 17 and 19. The other two pieces of information are effectively defined by the way that the RF filter impulse response function, as estimated by the system identification procedures of Ref. 21, is defined relative to the C/A code DLL tracking point. If the same DLL is used for spoofing detection as was used for the RF filter system identification and if the same PRN code is being tracked as one of the codes that was used for system identification, then this relative timing should be well known. In other situations, a calibration must be made of this relative timing. This relative timing calibration is the semi-codeless equivalent of the codeless timing offset ?tab. Recall that this latter offset is used in Eq.  of the codeless spoofing detection calculations. In the semi-codeless case, each receiver has its own independent relative timing of the W chips and their associated filtered P chips relative to the C/A-code DLL tracking point. The effects of changes in the semi-codeless relative timing assumptions have been examined experimentally, and results from this study are reported in Section V. The P(Y) code amplitude Ap in Eq.  must be deduced from the C/A code amplitude in order to define the estimation problem. The formula for this amplitude is  Recall that AIQ is the C/A-code prompt accumulation amplitude from Eq. . This equation is the semicodeless equivalent of codeless Eq. . The factor 2/ Naccum transforms from accumulation amplitude to carrier amplitude. The square-root in Eq.  arises because this is an amplitude equation rather than a power equation. The tern Lfpy is missing from Eq.  because this component of power loss is modeled not by the carrier amplitude Ap but by the filtered time histories Pfwj(t). The power of 10 in Eq.  accounts for the differing losses of the C/A code power and the P(Y) code power in the +/-10.23 MHz bandwidth in comparison to their infinite-bandwidth powers. Optimization of the cost function in Eq.  is performed iteratively. The ad hoc iteration strategy relies on the following fact: The overlaps of the neighboring non-zero portions of the Pfwj(t) functions are small relative to the time spans over which they have appreciable non-zero values. This fact is evident in the bottom plot of Fig. 2. Therefore, reasonable first-cut estimates of the W-chips are:   where iminj and imaxj are, respectively, the minimum and maximum sample indices i for which Pfwj(ti) is appreciably different from zero. The sign[] function in Eq.  returns a +1 for a positive or zero input argument and a -1 for a negative input argument. If there were no non-zero overlaps between neighboring Pfwj(t) functions, then the W-chip estimates in Eq.  would be optimal. In the presence of minor overlaps, the following heuristic iteration should converge to the optimal solution   where old w? l for l = 1, ..., K are the chip estimates from the previous iteration and where L is the number of neighboring chips on each side of wj whose Pfwl(t) 13 functions have appreciable non-zero overlap with the Pfwj(t) function. For the cases considered in this paper, L = 2 has been selected as a conservative estimate. The value L = 1 probably would have sufficed, and it would have saved computation time. Note: for j values less than L+1 or greater than K-L, one or the other of the summations over l in Eq.  must be truncated appropriately. The iterative optimization starts by generating W-chip estimates using Eq. . Next, it updates its W-chip estimates using Eq. . It repeats the evaluations in Eq.  using the w? j values from the previous iteration as its old w?l values for each new iteration. It terminates the iterative process when w? j = old w? j for all j = 1, ..., K. The rate of convergence of the iterations is dependent on the receiver design through its RF filter's distorting effect on the Pfwj(t) functions. Experience with this algorithm's convergence properties has been gained for the receivers used in the present study. The algorithm always terminated in 7 or fewer iterations, and the average number of iterations was less than 5. The required number of iterations should decrease for a higher bandwidth RF front-end. The sign[] function in Eqs.  and  ensures that the resulting W-chip estimates are either +1-valued or -1- valued. Thus, the constraint in Eq.  is enforced by this heuristic optimization procedure. Because of these constraints, the resulting W-chip estimates are termed "hard" estimates. 
B. Probability of W-Chip Correctness and "Soft" WChip Estimates 
One could directly correlate the "hard" +1/-1 W-chip estimates of the previous sub-section between Receivers A and B in order to form a spoofing detection statistic. It is well known, however, that "hard" W-chip estimates are not optimal when performing semi-codeless tracking of the L2 signal in dual-frequency receivers 17. Therefore, it seems wise to develop "soft" W-chip estimates in the hopes of improving the detection power of the semicodeless statistic. Reasonable "soft" W-chip estimates can be derived based on the probabilities of correctness of the corresponding "hard" estimates. Assuming that the random errors in Eqs.  and  are described by the statistics in Eqs. -, the probability that w? j is correct is approximately   This probability formula is based on the assumption that the normalized cost function 2 2J (w1,...,wK ) /? RF is the negative log likelihood of the W chips and, up to a constant offset, that it is also the negative logarithm of the a posteriori probability of the W chips. The loglikelihood assumption is consistent with Eqs. -. The equivalence between the log-likelihood function and the log a posteriori probability is a consequence of Bayes' formula and the uniform prior assumption that both possible W-chip values are equally likely 22. The only difference between the two cost terms in the exponential in Eq.  is the sign of the estimate of wj. The value w? j produces a lower cost than does the value ?w? j . Therefore, the exponent in Eq.  is guaranteed to be negative, and P{w? j} is guaranteed to be greater than 0.5. The probability formula in Eq.  is inexact for the situation of significant non-zero overlap between neighboring Pfwj(t) functions. In this situation, the exact formula would involve a normalized sum over all possible combinations of +1/-1 values of the chips other than w? j . Given the small overlaps, however, the approximation in Eq.  is reasonable. In the event of larger overlaps, an appropriate alternative to Eq.  could be developed. It has been omitted due to the lack of a perceived need and for the sake of brevity. The RF sample variance from Eq.  can be used in Eq. , but an alternate value can be deduced directly from the optimal value of the Eq.- cost. That value is   This formula is consistent with the statistical assumptions of Eqs. -. This alternative form of 2 ? RF has been used to generate results in the present paper. Although never very much different than the value computed in Eq. , this alternate value appears to be a more reliable indicator of the random noise levels in Eqs.  and . The probability of a correct w? j estimate from Eq.  can be used to compute the probability that the correct estimate is wj = +1. This latter probability is   The "soft" estimate of wj used in this paper is its conditional expectation value based on the receiver's quadrature baseband data, yq1, yq2, yq3, ..., yqi, ... It is: w? sj = E{wj | yq1, yq2, yq3,K} = 2P j(+) ?1  This estimate is guaranteed lie in the range -1 ? w? sj ? 1. 14 It takes on the end-point values if P j(+) takes on the value 0 or 1. It equals 0 if P j(+) = 0.5. Thus, w? sj is a reasonable "soft" estimate of wj. As in the case of codeless spoofing detection, the foregoing optimal estimation algorithm and analyses ignore the fact that the noise in the quadrature basebandmixed signal is not purely white noise. If the violation of the whiteness assumption were significant, then the derivations of this subsection and the previous subsection would have to be modified in order to account for the noise correlations. The primary change would be to modify the cost function in Eq.  to include crossproducts between Eq.- error terms with sample indices i that were near each other. The resulting modified cost would remain the negative log likelihood of the W chips after rescaling by 2 /? R2F . These modifications to the W-chips estimation algorithm and the associated analyses appear to be unnecessary for the receivers considered in this paper, and they have been omitted for the sake of brevity. 
C. Spoofing Detection via Correlation of "Soft" WChip Estimates 
The soft W-chip estimates can be used to develop a spoofing test statistic that is Neyman-Pearson optimal in the limit of weak signals in Receiver B. The derivation of this test statistic assumes the availability of Paj(+) , reference Receiver A's calculated probability that chip wj is positive. The derivation also assumes that the filtered P-code functions corresponding to any two distinct Wchips, say wj and wl, have insignificant overlap of their non-zero parts so that they are orthogonal. In other words, it assumes that   This assumption allows a re-scaled version of the cost function in Eq.  for Receiver B to be re-written in the form:  where the newly defined quantities on the right-hand side  The re-scaled cost function in Eq.  is the negative log probability density of the Receiver B quadrature baseband mixed measurements yqb1, ..., yqbM. The corresponding probability density is conditioned on the W-chip values w1, ..., wK and on the P(Y)-code amplitude Apb. Therefore, conditional probability density functions of the measurements for the un-spoofed and spoofed cases can be derived by using Eq.  along with the known Wchip probabilities from Receiver A. For the un-spoofed hypothesis, H0, this conditional density function is   where c is a normalizing constant. The nominal spoofed hypothesis, H1, assumes that there is nothing besides receiver noise on the quadrature channel. This hypothesis is the equivalent of using a Receiver-B P(Y) amplitude of Apb = 0. The measurement probability density for this case is p( yqb1,K, yqbM | H1) = c exp(?J~b0 )  The Neyman Pearson spoofing detection test statistic in this case is   If this statistic lies above a certain threshold value, then the un-spoofed hypothesis H0 is accepted. Otherwise, the spoofed hypothesis H1 is accepted, and a spoofing alert is issued. Using algebra and hyperbolic trigonometry, one can derive equivalent forms of ?sopt that are useful for analysis:  An equivalent detection statistic is   One can derive a low-power approximation for Receiver B by expanding this statistic in a Taylor series about the values w? sbj = 0. The result, to second order in w? sbj , is   Before proceeding further, it is worthwhile to examine this spoofing detection statistic. The first term in its sum is the product of the "soft" W-chip estimates from the two receivers. This whole analysis has been developed with the goal of deriving a detection statistic of this form. The second term, however, looks mostly for power in the P(Y) signal of Receiver B. If Receiver A has a very high carrier-to-noise ratio, then each of its w? saj estimates will be very near +1 or -1. In this case, the second term on the right-hand side of Eq.  will be insignificant because (1 ? 2 ) ? wsaj will be nearly zero. In other cases, however, the second term will indicate that there is a valid unspoofed signal whenever it detects appreciable P(Y) signal power in Receiver B. The proposed spoofing detection statistic in Eq.  leads to a dangerous situation. Suppose that a spoofer were to put P(Y) pseudo-code on the quadrature channel with randomly chosen false wj chips. In this case, the first term in Eq.  would contribute zero to the spoofing statistic, on average, but the second term could contribute a significant positive component, possibly enough to cause a missed detection. This situation can be resolved by considering an alternate spoofing hypothesis, H1'. The spoofer generates a false P(Y) code with randomly chosen +1/-1 values for its W chips. Suppose that it assigns equal probabilities to the potential wj values +1 and -1. The probability density of the Receiver B quadrature samples conditioned on spoofing hypothesis H1' then becomes   This statistic does not suffer from the problem of too much probability of a missed detection because of false P(Y) code on the spoofed quadrature signal. In order to simplify further analysis, the spoofing detection statistic is truncated to retain only the first-order terms in w? sbj . Thus, the final statistic chosen for semicodeless "soft" W-chips spoofing detection is   This spoofing detection statistic is optimal in the limit of very low P(Y) power in defended Receiver B. It is optimal for any level of P(Y) power in reference Receiver A. At higher P(Y) powers in Receiver B, this statistic is sub-optimal. As for locally most powerful detection tests, one can normally tolerate sub-optimality in the case of a stronger signal. This first-order truncation of the logarithmic Taylor series avoids the possibility that false W chips could defeat the detection. Nevertheless, the foregoing analysis of the 16 false W-chips case has been worthwhile. It suggests additional analyses that should be carried out in the future. The needed analyses would explore whether there are sophisticated spoofing attack scenarios which could overcome the defenses that are developed in the present paper.
 D. Probability Analysis and Detection Threshold Design for the "Soft" W-Chips Test Statistic 
At the point of spoofing detection, the random variability of the ? s spoofing detection statistic in Eq.  comes entirely from the variability of the w? sbj soft W-chip estimates. Although the w? saj estimates will have been affected by random noise in reference Receiver A, these will be known quantities at the time of spoofing detection in Receiver B. The randomness in w? sbj can be characterized by using its formula in terms of ?bj, Eq. , coupled with the probability density of ?bj. The randomness in ?bj comes from the random noise in the yqbi quadrature baseband mixed samples, as per Eq. . Therefore, ?bj follows a Gaussian distribution in each of the 3 possible situations: a) the signal is not being spoofed and the true wj is +1, b) the signal is not being spoofed and the true wj is -1, or c) the signal is being spoofed so that yqbi contains only random noise. The mean and variance of ?bj can be deduced in each of these situations by substituting the models in Eqs.  and  into Eq.  and by taking appropriate expectations based on the statistical models in Eq. . Given these means and variances and given the wj = +1 chip probabilities from reference Receiver A, the un-spoofed and spoofed conditional probability densities for ?bj are:   In preparation for computing the means and variances of the spoofing detection statistic ? s under the two hypotheses, one can compute the corresponding expectation values of w? sbj and w? s2bj . These are computed by using the model for w? sbj in terms of ?bj in Eq.  and the probability density functions in Eqs.  and . The results are:  The analyses that derive Eqs. - involve changes of dummy integration variables from ?bj to ?. They require two proofs involving modifications to the integral in Eq. . One proof demonstrates that a change from (?+?) to (-?+?) in the tanh function argument of the integrand causes the resulting formula to yield -q(?). The other proof demonstrates that a squaring of the tanh function causes the resulting formula to remain equal to q(?). The special functions defined in Eqs.  and  can be evaluated approximately via numerical integration. For purposes of this paper, they have been pre-computed off-line on an extensive grid of ? points. Afterwards, their pre-computed values have been used in an interpolation scheme in order to provide a quick, practical means of evaluating them. The results in Eqs. - can be used to compute the corresponding means and variances of the spoofing statistic ? s. These calculations rely in the assumption that any two "soft" W-chip estimates w? sbj and w? sbl for j ? l are sampled from independent distributions.  17 As in the codeless case, the means and variances in Eqs. - are used to design and analyze the spoofing detection test. This involves the probability density functions p( ? s|H0) and p( ? s|H1). These are non-Gaussian due to the non-Gaussian nature of the w? sbj distributions. Given that many such random quantities affect the correlation statistic summation in Eq. , however, the central limit theorem can be invoked in order to argue that Gaussian approximations of these two distributions are reasonable. Given the false-alarm probability ?FA and the Gaussian assumption, the spoofing detection threshold ?sth is the solution of the following equation:   If ? s ??sth, then hypothesis H0 is accepted: there is no spoofing. If ? s <?sth, then hypothesis H1 is accepted, and a spoofing alert is issued. The probability of successful spoofing detection is:   As in the codeless case, the un-spoofed H0 hypothesis is atypical because the test statistic's mean value is non-zero. The accuracy of the mean valued given in Eq.  is dependent on the accuracy of the modeled P(Y)-code carrier amplitudes in the two receivers, Apa and Apb as computed using Eq. . Any errors in these calculations will lead to errors in the predicted mean ? s|H0 and in the detection threshold ?sth. Any such errors will distort the false-alarm probability and the probability of detection away from the values given in Eqs.  and .